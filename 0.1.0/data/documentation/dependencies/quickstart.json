{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Adding-the-Dependencies-library-as-a-dependency","level":2,"type":"heading","text":"Adding the Dependencies library as a dependency"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To use this library in a SwiftPM project, add it to the dependencies of your Package.swift and"},{"type":"text","text":" "},{"type":"text","text":"specify the "},{"type":"codeVoice","code":"Dependencies"},{"type":"text","text":" product in any targets that need access to the library:"}]},{"type":"codeListing","syntax":"swift","code":["let package = Package(","  dependencies: [","    .package(","      url: \"https:\/\/github.com\/pointfreeco\/swift-dependencies\",","      from: \"0.1.0\"","    ),","  ],","  targets: [","    .target(","      name: \"<your-target-name>\",","      dependencies: [","        .product(name: \"Dependencies\", package: \"swift-dependencies\")","      ]","    )","  ]",")"]},{"anchor":"Using-your-first-dependency","level":2,"type":"heading","text":"Using your first dependency"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The library allows you to register your own dependencies, but it also comes with many controllable"},{"type":"text","text":" "},{"type":"text","text":"dependencies out of the box (see "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/DependencyValues"},{"type":"text","text":" for a full list), and there"},{"type":"text","text":" "},{"type":"text","text":"is a good chance you can immediately make use of one. If you are using "},{"type":"codeVoice","code":"Date()"},{"type":"text","text":", "},{"type":"codeVoice","code":"UUID()"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"codeVoice","code":"Task.sleep"},{"type":"text","text":", or Combine schedulers directly in your feature‚Äôs logic, you can already start to use"},{"type":"text","text":" "},{"type":"text","text":"this library."}]},{"type":"codeListing","syntax":"swift","code":["final class FeatureModel: ObservableObject {","  @Dependency(\\.continuousClock) var clock  \/\/ Controllable way to sleep a task","  @Dependency(\\.date.now) var now           \/\/ Controllable way to ask for current date","  @Dependency(\\.mainQueue) var mainQueue    \/\/ Controllable scheduling on main queue","  @Dependency(\\.uuid) var uuid              \/\/ Controllable UUID creation","","  \/\/ ...","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once your dependencies are declared, rather than reaching out to the "},{"type":"codeVoice","code":"Date()"},{"type":"text","text":", "},{"type":"codeVoice","code":"UUID()"},{"type":"text","text":", etc."},{"type":"text","text":" "},{"type":"text","text":"directly, you can use the dependency that is defined directly on your feature‚Äôs model:"}]},{"type":"codeListing","syntax":"swift","code":["final class FeatureModel: ObservableObject {","  \/\/ ...","","  func addButtonTapped() async throws {","    try await self.clock.sleep(for: .seconds(1))  \/\/ üëà Don't use Task.sleep","    self.items.append(","      Item(","        id: self.uuid(),  \/\/ üëà Don't use UUID()","        name: \"\",","        createdAt: self.now  \/\/ üëà Don't use Date()","      )","    )","  }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"That is all it takes to start using controllable dependencies in your features. With that little"},{"type":"text","text":" "},{"type":"text","text":"bit of upfront work done you can start to take advantage of the library‚Äôs powers."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"For example, you can easily control these dependencies in tests. If you want to test the logic"},{"type":"text","text":" "},{"type":"text","text":"inside the "},{"type":"codeVoice","code":"addButtonTapped"},{"type":"text","text":" method, you can use the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/withDependencies(_:operation:)-4uz6m"},{"type":"text","text":" "},{"type":"text","text":"function to override any dependencies for the scope of one single test. It‚Äôs as easy as 1-2-3:"}]},{"type":"codeListing","syntax":"swift","code":["func testAdd() async throws {","  let model = withDependencies {","    \/\/ 1Ô∏è‚É£ Override any dependencies that your feature uses.","    $0.clock = ImmediateClock()","    $0.date.now = Date(timeIntervalSinceReferenceDate: 1234567890)","    $0.uuid = .incrementing","  } operation: {","    \/\/ 2Ô∏è‚É£ Construct the feature's model","    FeatureModel()","  }","","  \/\/ 3Ô∏è‚É£ The model now executes in a controlled environment of dependencies,","  \/\/    and so we can make assertions against its behavior.","  try await model.addButtonTapped()","  XCTAssertEqual(","    model.items,","    [","      Item(","        id: UUID(uuidString: \"00000000-0000-0000-0000-000000000000\")!,","        name: \"\",","        createdAt: Date(timeIntervalSinceReferenceDate: 1234567890)","    ]","  )","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here we controlled the "},{"type":"codeVoice","code":"date"},{"type":"text","text":" dependency to always return the same date, and we controlled the"},{"type":"text","text":" "},{"type":"codeVoice","code":"uuid"},{"type":"text","text":" dependency to return an auto-incrementing UUID every time it is invoked. If we did not"},{"type":"text","text":" "},{"type":"text","text":"control these dependencies this test would be very difficult to write since there is no way to"},{"type":"text","text":" "},{"type":"text","text":"accurately predict what will be returned by "},{"type":"codeVoice","code":"Date()"},{"type":"text","text":" and "},{"type":"codeVoice","code":"UUID()"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"But, controllable dependencies aren‚Äôt only useful for tests. They can also be used in Xcode"},{"type":"text","text":" "},{"type":"text","text":"previews. Suppose the feature above makes use of a clock to sleep for an amount of time before"},{"type":"text","text":" "},{"type":"text","text":"something happens in the view. If you don‚Äôt want to literally wait for time to pass in order to see"},{"type":"text","text":" "},{"type":"text","text":"how the view changes, you can override the clock dependency to be an ‚Äúimmediate‚Äù clock using the"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/withDependencies(_:operation:)-4uz6m"},{"type":"text","text":" helper:"}]},{"type":"codeListing","syntax":"swift","code":["struct Feature_Previews: PreviewProvider {","  static var previews: some View {","    FeatureView(","      model: withDependencies {","        $0.clock = ImmediateClock()","      } operation: {","        FeatureModel()","      }","    )","  }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This will make it so that the preview uses an immediate clock when run, but when running in a"},{"type":"text","text":" "},{"type":"text","text":"simulator or on device it will still use a live "},{"type":"codeVoice","code":"ContinuousClock"},{"type":"text","text":". This makes it possible to"},{"type":"text","text":" "},{"type":"text","text":"override dependencies just for previews without affecting how your app will run in production."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"That is the basics to getting started with using the library, but there is still a lot more you"},{"type":"text","text":" "},{"type":"text","text":"can do. You can learn more in depth about "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/WhatAreDependencies"},{"type":"text","text":" as well as"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/UsingDependencies"},{"type":"text","text":". Once comfortable with that you can learn about"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/RegisteringDependencies"},{"type":"text","text":" as well as how to best leverage "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/LivePreviewTest"},{"type":"text","text":". And finally,"},{"type":"text","text":" "},{"type":"text","text":"there are more advanced topics to explore, such as "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/DesigningDependencies"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/OverridingDependencies"},{"type":"text","text":", "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/Lifetimes"},{"type":"text","text":" and "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/SingleEntryPointSystems"},{"type":"text","text":"."}]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/dependencies\/quickstart"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/Dependencies\/documentation\/Dependencies\/QuickStart","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Learn the basics of getting started with the library before diving deep into all of its features."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Quick start","role":"article","modules":[{"name":"Dependencies"}]},"hierarchy":{"paths":[["doc:\/\/Dependencies\/documentation\/Dependencies"]]},"seeAlsoSections":[{"title":"Getting started","identifiers":["doc:\/\/Dependencies\/documentation\/Dependencies\/WhatAreDependencies"],"generated":true}],"references":{"doc://Dependencies/documentation/Dependencies/LivePreviewTest":{"role":"article","title":"Live, preview, and test dependencies","abstract":[{"type":"text","text":"Learn how to provide different implementations of your dependencies for use in the live application,"},{"type":"text","text":" "},{"type":"text","text":"as well as in Xcode previews, and even in tests."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/LivePreviewTest","kind":"article","type":"topic","url":"\/documentation\/dependencies\/livepreviewtest"},"doc://Dependencies/documentation/Dependencies/UsingDependencies":{"role":"article","title":"Using dependencies","abstract":[{"type":"text","text":"Learn how to use the dependencies that are registered with the library."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/UsingDependencies","kind":"article","type":"topic","url":"\/documentation\/dependencies\/usingdependencies"},"doc://Dependencies/documentation/Dependencies/OverridingDependencies":{"role":"article","title":"Overriding dependencies","abstract":[{"type":"text","text":"Learn how dependencies can be changed at runtime so that certain parts of your application can use"},{"type":"text","text":" "},{"type":"text","text":"different dependencies."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/OverridingDependencies","kind":"article","type":"topic","url":"\/documentation\/dependencies\/overridingdependencies"},"doc://Dependencies/documentation/Dependencies/SingleEntryPointSystems":{"role":"article","title":"Single entry point systems","abstract":[{"type":"text","text":"Learn about ‚Äúsingle entry point‚Äù systems, and why they are best suited for this dependencies"},{"type":"text","text":" "},{"type":"text","text":"library, although it is possible to use the library with non-single entry point systems."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/SingleEntryPointSystems","kind":"article","type":"topic","url":"\/documentation\/dependencies\/singleentrypointsystems"},"doc://Dependencies/documentation/Dependencies/DesigningDependencies":{"role":"article","title":"Designing dependencies","abstract":[{"type":"text","text":"Learn techniques on designing your dependencies so that they are most flexible for injecting into"},{"type":"text","text":" "},{"type":"text","text":"features and overriding for tests."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/DesigningDependencies","kind":"article","type":"topic","url":"\/documentation\/dependencies\/designingdependencies"},"doc://Dependencies/documentation/Dependencies/Lifetimes":{"role":"article","title":"Dependency lifetimes","abstract":[{"type":"text","text":"Learn about the lifetimes of dependencies, how to prolong the lifetime of a dependency, and how"},{"type":"text","text":" "},{"type":"text","text":"dependencies are inherited."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/Lifetimes","kind":"article","type":"topic","url":"\/documentation\/dependencies\/lifetimes"},"doc://Dependencies/documentation/Dependencies/RegisteringDependencies":{"role":"article","title":"Registering dependencies","abstract":[{"type":"text","text":"Learn how to register your own dependencies with the library so that they immediately become"},{"type":"text","text":" "},{"type":"text","text":"available from any part of your code base."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/RegisteringDependencies","kind":"article","type":"topic","url":"\/documentation\/dependencies\/registeringdependencies"},"doc://Dependencies/documentation/Dependencies/DependencyValues":{"role":"symbol","title":"DependencyValues","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"DependencyValues"}],"abstract":[{"type":"text","text":"A collection of dependencies that is globally available."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/DependencyValues","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"DependencyValues"}],"url":"\/documentation\/dependencies\/dependencyvalues"},"doc://Dependencies/documentation/Dependencies/WhatAreDependencies":{"role":"article","title":"What are dependencies?","abstract":[{"type":"text","text":"Learn what dependencies are, how they complicate your code, and why you want to control them."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/WhatAreDependencies","kind":"article","type":"topic","url":"\/documentation\/dependencies\/whataredependencies"},"doc://Dependencies/documentation/Dependencies/withDependencies(_:operation:)-4uz6m":{"role":"symbol","title":"withDependencies(_:operation:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"withDependencies"},{"kind":"text","text":"<"},{"kind":"genericParameter","text":"R"},{"kind":"text","text":">(("},{"kind":"keyword","text":"inout"},{"kind":"text","text":" "},{"kind":"typeIdentifier","text":"DependencyValues","preciseIdentifier":"s:12Dependencies16DependencyValuesV"},{"kind":"text","text":") "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"Void","preciseIdentifier":"s:s4Voida"},{"kind":"text","text":", "},{"kind":"externalParam","text":"operation"},{"kind":"text","text":": () "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"R"},{"kind":"text","text":") "},{"kind":"keyword","text":"rethrows"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"R"}],"abstract":[{"type":"text","text":"Updates the current dependencies for the duration of a synchronous operation."}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies\/withDependencies(_:operation:)-4uz6m","kind":"symbol","type":"topic","url":"\/documentation\/dependencies\/withdependencies(_:operation:)-4uz6m"},"doc://Dependencies/documentation/Dependencies":{"role":"collection","title":"Dependencies","abstract":[{"type":"text","text":"A dependency management library inspired by SwiftUI‚Äôs ‚Äúenvironment.‚Äù"}],"identifier":"doc:\/\/Dependencies\/documentation\/Dependencies","kind":"symbol","type":"topic","url":"\/documentation\/dependencies"}}}